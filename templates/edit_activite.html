<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ 'Modifier' if action == 'modifier' else 'Nouvelle' }} Activité</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
</head>
<body>
    {% extends "dashboard.html" %}
    
    {% block content %}
    <div class="container">
        <h1>{{ 'Modifier' if action == 'modifier' else 'Nouvelle' }} Activité</h1>
        
        <form method="POST">
            <div class="mb-3">
                <label for="titre" class="form-label">Titre *</label>
                <input type="text" class="form-control" id="titre" name="titre" 
                       value="{{ activite.titre if activite else '' }}" required>
            </div>
            
            <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea class="form-control" id="description" name="description" rows="3">
                    {{ activite.description if activite else '' }}
                </textarea>
            </div>
            
            <div class="mb-3">
                <label for="image_url" class="form-label">URL de l'image</label>
                <input type="url" class="form-control" id="image_url" name="image_url"
                       value="{{ activite.image_url if activite else '' }}">
            </div>
            
            <div class="mb-3">
                <label for="contenu" class="form-label">Contenu *</label>
                <div id="editor" style="height: 300px;"></div>
                <textarea id="contenu" name="contenu" style="display: none;">
                    {{ activite.contenu if activite else '' }}
                </textarea>
            </div>
            
            <div class="d-flex justify-content-between">
                <a href="{{ url_for('activites') }}" class="btn btn-secondary">Annuler</a>
                <button type="submit" class="btn btn-primary">
                    {{ 'Mettre à jour' if action == 'modifier' else 'Créer' }}
                </button>
            </div>
        </form>
    </div>
    
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        const quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, false] }],
                    ['bold', 'italic', 'underline'],
                    ['link', 'image'],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }]
                ]
            }
        });
        
        // Charger le contenu existant
        const contentField = document.getElementById('contenu');
        quill.root.innerHTML = contentField.value;
        
        // Mettre à jour le champ caché avant soumission
        document.querySelector('form').addEventListener('submit', function() {
            contentField.value = quill.root.innerHTML;
        });
    </script>
    {% endblock %}
</body>
</html>